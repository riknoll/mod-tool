{"version":3,"sources":["components/Alert.tsx","components/Asset.tsx","images.ts","share.ts","components/AssetList.tsx","App.tsx","index.tsx"],"names":["Alert","evt","stopPropagation","preventDefault","this","props","visible","title","text","icon","options","className","onClick","onClose","onAlertClick","children","map","el","i","key","React","Component","Asset","renameInput","onBlur","e","onRename","target","value","setState","renaming","onDoubleClick","handleInputRef","state","focus","prevProps","prevState","info","selected","onDelete","name","jres","src","previewURI","alt","defaultValue","ref","getJRESImageFromDataString","data","palette","qname","tilemapTile","sourceFile","getJRESImage","jresURL","atob","slice","indexOf","magic","charCodeAt","w","h","out","Bitmap","index","mask","v","x","y","set","jresDataToBitmap","getJRESImageFromImageLiteral","literal","defaultPattern","replace","trim","rows","split","sprite","spriteWidth","r","length","row","rowValues","c","push","Math","max","spriteHeight","result","imageLiteralToBitmap","undefined","bitmap","width","height","base64EncodeBitmap","bitmapToImageURI","qualifiedName","f4EncodeImgCore","bpp","getPix","hex2","ptr","curr","shift","pushBits","n","j","toString","hex","get","btoa","input","len","res","String","fromCharCode","uint8ArrayToString","Uint8ClampedArray","parseInt","hexToUint8Array","x0","y0","buf","dataLength","col","coordToIndex","setCore","getCore","cell","floor","ceil","frame","colors","canvas","document","createElement","context","getContext","color","fillStyle","fillRect","toDataURL","backendEndpoint","arcadePalette","url","a","scriptID","substr","lastIndexOf","httpGetJSONAsync","meta","filesystem","config","paletteIsCustom","parsedConfig","JSON","parse","Array","isArray","typescriptFiles","Object","keys","filter","filename","endsWith","projectImages","fileText","grabImagesFromJRES","grabImagesFromTypeScript","seenImages","image","existing","files","customPalette","jresText","metaEntry","metaMime","mimeType","metaNamespace","namespace","id","entry","literalRegex","match","Promise","resolve","reject","request","XMLHttpRequest","addEventListener","err","responseText","open","send","DEFAULT_JRES","AssetList","_items","_inputRef","handleMessage","msg","type","jresImage","message","saving","items","loadJres","asset","postMessage","getJres","onAssetClick","onAssetRename","renameAsset","onAddButtonClick","addAsset","onDeleteButtonClick","alert","deleteAsset","hideAlert","onImportButtonClick","importAssets","onExportButtonClick","window","removeEventListener","getValidAssetName","splice","newName","fetchMakeCodeScriptAsync","then","forEach","findIndex","toLowerCase","getAssetIndex","placeholder","item","App","iframe","contentWindow","getElementById","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.961cde60.chunk.js","sourcesContent":["import React from 'react';\r\nimport '../styles/Alert.css';\r\n\r\ninterface AlertOption {\r\n    text: string;\r\n    onClick: () => void;\r\n}\r\n\r\nexport interface AlertProps {\r\n    title: string;\r\n    text: string;\r\n    icon?: string;\r\n    options?: AlertOption[];\r\n    visible?: boolean;\r\n    onClose?: () => void;\r\n}\r\n\r\nexport class Alert extends React.Component<AlertProps, {}> {\r\n    onAlertClick(evt: any) {\r\n        evt.stopPropagation();\r\n        evt.preventDefault();\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.visible) return <div />;\r\n\r\n        const { title, text, icon, options } = this.props;\r\n        return <div className=\"alert-container\" onClick={this.props.onClose}>\r\n            <div className=\"alert\" onClick={this.onAlertClick}>\r\n                <div className=\"alert-title\">\r\n                    {icon && <i className={`alert-icon icon ${icon}`}></i>}\r\n                    <span>{title}</span>\r\n                    <i className=\"icon delete\" onClick={this.props.onClose}></i>\r\n                </div>\r\n                <div className=\"alert-text\">{text}</div>\r\n                {this.props.children && this.props.children}\r\n                {options && <div className=\"alert-options\">\r\n                    {options.map((el, i) => {\r\n                        return <div key={i} onClick={el.onClick}>{el.text}</div>\r\n                    })}\r\n                </div>}\r\n            </div>\r\n        </div>\r\n    }\r\n}","import React from 'react';\r\nimport { JRESImage } from '../images';\r\nimport '../styles/Asset.css';\r\n\r\nexport interface AssetInfo {\r\n    name: string;\r\n    jres: JRESImage;\r\n}\r\n\r\ninterface AssetProps {\r\n    info: AssetInfo;\r\n    selected: boolean;\r\n    onClick?: (e: any) => void;\r\n    onRename?: (name: string) => void;\r\n    onDelete?: (e: any) => void;\r\n}\r\n\r\ninterface AssetState {\r\n    renaming?: boolean;\r\n}\r\n\r\nexport class Asset extends React.Component<AssetProps, AssetState> {\r\n    private renameInput!: HTMLInputElement;\r\n    constructor(props: AssetProps) {\r\n        super(props);\r\n        this.state = { renaming: true }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.renameInput.focus();\r\n    }\r\n\r\n    componentDidUpdate(prevProps: AssetProps, prevState: AssetState) {\r\n        if (this.state.renaming && !prevState.renaming) {\r\n            this.renameInput.focus();\r\n        }\r\n    }\r\n\r\n    onBlur = (e: any) => {\r\n        if (this.props.onRename) this.props.onRename(e.target.value);\r\n        this.setState({ renaming: false });\r\n    }\r\n\r\n    onDoubleClick = (e: any) => {\r\n        this.setState({ renaming: true });\r\n    }\r\n\r\n    handleInputRef = (e: HTMLInputElement) => {\r\n        this.renameInput = e;\r\n    }\r\n\r\n    render() {\r\n        const { info, selected, onClick, onDelete } = this.props;\r\n        const { name, jres } = info;\r\n\r\n        return <div className={`asset ${selected ? \"selected\" : \"\"}`} onClick={onClick}>\r\n            {selected && <div className=\"asset-delete\" onClick={onDelete}>\r\n                <i className=\"icon delete\"></i>\r\n            </div>}\r\n            <div className=\"asset-img\">\r\n                <img src={jres.previewURI} alt=\"Preview of asset\" />\r\n            </div>\r\n            {this.state.renaming\r\n                ? <input className=\"asset-rename\" onBlur={this.onBlur} defaultValue={name} ref={this.handleInputRef} />\r\n                : <div className=\"asset-title\" onDoubleClick={this.onDoubleClick}><span>{name}</span></div>\r\n            }\r\n        </div>\r\n    }\r\n}","export interface JRESImage {\r\n    data: string; // Base64 encoded string of f4 encoded bytes\r\n    previewURI: string; // PNG data uri\r\n    width: number;\r\n    height: number;\r\n\r\n    qualifiedName?: string;\r\n    tilemapTile?: boolean;\r\n    sourceFile?: string;\r\n}\r\n\r\nexport interface ImageInfo {\r\n    width: number;\r\n    height: number;\r\n    pixels: Uint8ClampedArray;\r\n}\r\n\r\nexport async function getImageFromURIAsync(uri: string): Promise<ImageInfo | null> {\r\n    const loaded = await loadImageAsync(uri);\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = loaded.width;\r\n    canvas.height = loaded.height;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) return null;\r\n\r\n    ctx.drawImage(loaded, 0, 0);\r\n    const data = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n\r\n    return {\r\n        width: data.width,\r\n        height: data.height,\r\n        pixels: data.data\r\n    };\r\n}\r\n\r\nasync function loadImageAsync(uri: string): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>(resolve => {\r\n        const el = document.createElement(\"img\");\r\n        el.src = uri\r\n        el.onload = () => {\r\n            resolve(el)\r\n        };\r\n    })\r\n}\r\n\r\nexport function getJRESImageFromDataString(data: string, palette: string[], qname?: string, tilemapTile?: boolean, sourceFile?: string): JRESImage {\r\n    const bitmap = jresDataToBitmap(data);\r\n\r\n    return getJRESImage(bitmap, palette, data, qname, tilemapTile, sourceFile)\r\n}\r\n\r\nexport function getJRESImageFromImageLiteral(literal: string, palette: string[], sourceFile?: string) {\r\n    const bitmap = imageLiteralToBitmap(literal);\r\n    return getJRESImage(bitmap, palette, undefined, undefined, undefined, sourceFile)\r\n}\r\n\r\n\r\nfunction getJRESImage(bitmap: Bitmap, palette: string[], data?: string, qname?: string, tilemapTile?: boolean, sourceFile?: string): JRESImage {\r\n    return {\r\n        width: bitmap.width,\r\n        height: bitmap.height,\r\n        data: data || base64EncodeBitmap(bitmap),\r\n        previewURI: bitmapToImageURI(bitmap, palette),\r\n        qualifiedName: qname,\r\n        tilemapTile,\r\n        sourceFile\r\n    }\r\n}\r\n\r\n/**\r\n * Encodes the image in the image/mkcd-f4 format (used for the data attribute in jres files)\r\n * @param image\r\n * @param colors\r\n */\r\nexport function f4EncodeImage(image: ImageInfo, colors: string[]) {\r\n    const palette = colorsToNumbers(colors);\r\n\r\n    return f4EncodeImgCore(image.width, image.height, 4, (x, y) => {\r\n        const index = y * image.width + x;\r\n        return closestColor(image.pixels, index << 2, palette);\r\n    });\r\n}\r\n\r\n/**\r\n * Encodes the image as an img`` literal\r\n * @param image\r\n * @param colors\r\n */\r\nexport function imgEncodeImage(image: ImageInfo, colors: string[]) {\r\n    const palette = colorsToNumbers(colors);\r\n\r\n    return imgEncodeImgCore(image.width, image.height, (x, y) => {\r\n        const index = y * image.width + x;\r\n        return closestColor(image.pixels, index << 2, palette);\r\n    });\r\n}\r\n\r\nfunction colorsToNumbers(colors: string[]): number[][] {\r\n    const res: number[][] = [];\r\n    for (let i = 0; i < colors.length; i++) {\r\n        const color = parseColorString(colors[i]);\r\n        res.push([_r(color), _g(color), _b(color)]);\r\n    }\r\n    return res;\r\n}\r\n\r\n// use geometric distance on colors\r\nfunction scale(v: number) {\r\n    return v * v\r\n}\r\n\r\nfunction closestColor(buf: Uint8ClampedArray, pix: number, palette: number[][], alpha = true) {\r\n    if (alpha && buf[pix + 3] < 100)\r\n        return 0 // transparent\r\n    let mindelta = 0\r\n    let idx = -1\r\n    for (let i = alpha ? 1 : 0; i < palette.length; ++i) {\r\n        let delta = scale(palette[i][0] - buf[pix + 0]) + scale(palette[i][1] - buf[pix + 1]) + scale(palette[i][2] - buf[pix + 2])\r\n        if (idx < 0 || delta < mindelta) {\r\n            idx = i\r\n            mindelta = delta\r\n        }\r\n    }\r\n    return idx\r\n}\r\n\r\nfunction f4EncodeImgCore(w: number, h: number, bpp: number, getPix: (x: number, y: number) => number) {\r\n    let r = hex2(0xe0 | bpp) + hex2(w) + hex2(h) + \"00\"\r\n    let ptr = 4\r\n    let curr = 0\r\n    let shift = 0\r\n\r\n    let pushBits = (n: number) => {\r\n        curr |= n << shift\r\n        // eslint-disable-next-line\r\n        if (shift == 8 - bpp) {\r\n            r += hex2(curr)\r\n            ptr++\r\n            curr = 0\r\n            shift = 0\r\n        } else {\r\n            shift += bpp\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < w; ++i) {\r\n        for (let j = 0; j < h; ++j)\r\n            pushBits(getPix(i, j))\r\n        // eslint-disable-next-line\r\n        while (shift != 0)\r\n            pushBits(0)\r\n        if (bpp > 1) {\r\n            while (ptr & 3)\r\n                pushBits(0)\r\n        }\r\n    }\r\n\r\n    return r\r\n\r\n    function hex2(n: number) {\r\n        return (\"0\" + n.toString(16)).slice(-2)\r\n    }\r\n}\r\n\r\nfunction imgEncodeImgCore(w: number, h: number, getPix: (x: number, y: number) => number) {\r\n    let res = \"img`\\n    \"\r\n    for (let r = 0; r < h; r++) {\r\n        let row: number[] = []\r\n        for (let c = 0; c < w; c++) {\r\n            row.push(getPix(c, r));\r\n        }\r\n        res += row.map(n => n.toString(16)).join(\" \");\r\n        res += \"\\n    \"\r\n    }\r\n    res += \"`\";\r\n    return res;\r\n}\r\n\r\nfunction base64EncodeBitmap(bitmap: Bitmap) {\r\n    const hex = f4EncodeImgCore(bitmap.width, bitmap.height, 4, (x, y) => bitmap.get(x, y));\r\n    return btoa(uint8ArrayToString(hexToUint8Array(hex)))\r\n}\r\n\r\nfunction _r(color: number) { return (color >> 16) & 0xff }\r\nfunction _g(color: number) { return (color >> 8) & 0xff }\r\nfunction _b(color: number) { return color & 0xff }\r\n\r\nfunction parseColorString(color: string) {\r\n    if (color) {\r\n        if (color.length === 6) {\r\n            return parseInt(\"0x\" + color);\r\n        }\r\n        else if (color.length === 7) {\r\n            return parseInt(\"0x\" + color.substr(1));\r\n        }\r\n    }\r\n    return 0;\r\n}\r\n\r\n/**\r\n * 16-color sprite\r\n */\r\nexport class Bitmap {\r\n    protected buf: Uint8ClampedArray;\r\n\r\n    constructor(public width: number, public height: number, public x0 = 0, public y0 = 0, buf?: Uint8ClampedArray) {\r\n        this.buf = buf || new Uint8ClampedArray(this.dataLength());\r\n    }\r\n\r\n    set(col: number, row: number, value: number) {\r\n        if (col < this.width && row < this.height && col >= 0 && row >= 0) {\r\n            const index = this.coordToIndex(col, row);\r\n            this.setCore(index, value);\r\n        }\r\n    }\r\n\r\n    get(col: number, row: number) {\r\n        if (col < this.width && row < this.height && col >= 0 && row >= 0) {\r\n            const index = this.coordToIndex(col, row);\r\n            return this.getCore(index);\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    protected coordToIndex(col: number, row: number) {\r\n        return col + row * this.width;\r\n    }\r\n\r\n    protected getCore(index: number) {\r\n        const cell = Math.floor(index / 2);\r\n        if (index % 2 === 0) {\r\n            return this.buf[cell] & 0xf;\r\n        }\r\n        else {\r\n            return (this.buf[cell] & 0xf0) >> 4;\r\n        }\r\n    }\r\n\r\n    protected setCore(index: number, value: number) {\r\n        const cell = Math.floor(index / 2);\r\n        if (index % 2 === 0) {\r\n            this.buf[cell] = (this.buf[cell] & 0xf0) | (value & 0xf);\r\n        }\r\n        else {\r\n            this.buf[cell] = (this.buf[cell] & 0x0f) | ((value & 0xf) << 4);\r\n        }\r\n    }\r\n\r\n    protected dataLength() {\r\n        return Math.ceil(this.width * this.height / 2);\r\n    }\r\n}\r\n\r\n\r\nfunction jresDataToBitmap(jresURL: string) {\r\n    let data = atob(jresURL.slice(jresURL.indexOf(\",\") + 1))\r\n    let magic = data.charCodeAt(0);\r\n    let w = data.charCodeAt(1);\r\n    let h = data.charCodeAt(2);\r\n\r\n    if (magic === 0x87) {\r\n        magic = 0xe0 | data.charCodeAt(1);\r\n        w = data.charCodeAt(2) | (data.charCodeAt(3) << 8);\r\n        h = data.charCodeAt(4) | (data.charCodeAt(5) << 8);\r\n        data = data.slice(4);\r\n    }\r\n\r\n    const out = new Bitmap(w, h);\r\n\r\n    let index = 4\r\n    if (magic === 0xe1) {\r\n        // Monochrome\r\n        let mask = 0x01\r\n        let v = data.charCodeAt(index++)\r\n        for (let x = 0; x < w; ++x) {\r\n            for (let y = 0; y < h; ++y) {\r\n                out.set(x, y, (v & mask) ? 1 : 0);\r\n                mask <<= 1\r\n                // eslint-disable-next-line\r\n                if (mask == 0x100) {\r\n                    mask = 0x01\r\n                    v = data.charCodeAt(index++)\r\n                }\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        // Color\r\n        for (let x = 0; x < w; x++) {\r\n            for (let y = 0; y < h; y += 2) {\r\n                let v = data.charCodeAt(index++)\r\n                out.set(x, y, v & 0xf);\r\n                // eslint-disable-next-line\r\n                if (y != h - 1) {\r\n                    out.set(x, y + 1, (v >> 4) & 0xf);\r\n                }\r\n            }\r\n            while (index & 3) index++\r\n        }\r\n    }\r\n\r\n    return out;\r\n}\r\n\r\nfunction imageLiteralToBitmap(text: string, defaultPattern?: string): Bitmap {\r\n    // Strip the tagged template string business and the whitespace. We don't have to exhaustively\r\n    // replace encoded characters because the compiler will catch any disallowed characters and throw\r\n    // an error before the decompilation happens. 96 is backtick and 9 is tab\r\n    text = text.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g, \"\").trim();\r\n    // eslint-disable-next-line\r\n    text = text.replace(/^[\"`\\(\\)]*/, '').replace(/[\"`\\(\\)]*$/, '');\r\n    text = text.replace(/&#10;/g, \"\\n\");\r\n\r\n    if (!text && defaultPattern)\r\n        text = defaultPattern;\r\n\r\n    const rows = text.split(\"\\n\");\r\n\r\n    // We support \"ragged\" sprites so not all rows will be the same length\r\n    const sprite: number[][] = [];\r\n    let spriteWidth = 0;\r\n\r\n    for (let r = 0; r < rows.length; r++) {\r\n        const row = rows[r];\r\n        const rowValues: number[] = [];\r\n        for (let c = 0; c < row.length; c++) {\r\n            // This list comes from libs/screen/targetOverrides.ts in pxt-arcade\r\n            // Technically, this could change per target.\r\n            switch (row[c]) {\r\n                case \"0\": case \".\": rowValues.push(0); break;\r\n                case \"1\": case \"#\": rowValues.push(1); break;\r\n                case \"2\": case \"T\": rowValues.push(2); break;\r\n                case \"3\": case \"t\": rowValues.push(3); break;\r\n                case \"4\": case \"N\": rowValues.push(4); break;\r\n                case \"5\": case \"n\": rowValues.push(5); break;\r\n                case \"6\": case \"G\": rowValues.push(6); break;\r\n                case \"7\": case \"g\": rowValues.push(7); break;\r\n                case \"8\": rowValues.push(8); break;\r\n                case \"9\": rowValues.push(9); break;\r\n                case \"a\": case \"A\": case \"R\": rowValues.push(10); break;\r\n                case \"b\": case \"B\": case \"P\": rowValues.push(11); break;\r\n                case \"c\": case \"C\": case \"p\": rowValues.push(12); break;\r\n                case \"d\": case \"D\": case \"O\": rowValues.push(13); break;\r\n                case \"e\": case \"E\": case \"Y\": rowValues.push(14); break;\r\n                case \"f\": case \"F\": case \"W\": rowValues.push(15); break;\r\n            }\r\n        }\r\n\r\n        if (rowValues.length) {\r\n            sprite.push(rowValues);\r\n            spriteWidth = Math.max(spriteWidth, rowValues.length);\r\n        }\r\n    }\r\n\r\n    const spriteHeight = sprite.length;\r\n\r\n    const result = new Bitmap(spriteWidth, spriteHeight)\r\n\r\n    for (let r = 0; r < spriteHeight; r++) {\r\n        const row = sprite[r];\r\n        for (let c = 0; c < spriteWidth; c++) {\r\n            if (c < row.length) {\r\n                result.set(c, r, row[c]);\r\n            }\r\n            else {\r\n                result.set(c, r, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Converts a bitmap into a square image suitable for display\r\n */\r\nfunction bitmapToImageURI(frame: Bitmap, colors: string[]) {\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = frame.width;\r\n    canvas.height = frame.height;\r\n\r\n    let context = canvas.getContext(\"2d\");\r\n\r\n    if (context) {\r\n        for (let c = 0; c < frame.width; c++) {\r\n            for (let r = 0; r < frame.height; r++) {\r\n                const color = frame.get(c, r);\r\n\r\n                if (color) {\r\n                    context.fillStyle = colors[color];\r\n                    context.fillRect(c, r, 1, 1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    return canvas.toDataURL();\r\n}\r\n\r\nfunction hexToUint8Array(hex: string) {\r\n    let r = new Uint8ClampedArray(hex.length >> 1);\r\n    for (let i = 0; i < hex.length; i += 2)\r\n        r[i >> 1] = parseInt(hex.slice(i, i + 2), 16)\r\n    return r\r\n}\r\n\r\nfunction uint8ArrayToString(input: ArrayLike<number>) {\r\n    let len = input.length;\r\n    let res = \"\"\r\n    for (let i = 0; i < len; ++i)\r\n        res += String.fromCharCode(input[i]);\r\n    return res;\r\n}","import { getJRESImageFromDataString, getJRESImageFromImageLiteral, JRESImage } from \"./images\";\r\n\r\nconst backendEndpoint = \"https://makecode.com/api\";\r\n\r\nconst IMAGE_MIME_TYPE = \"image/x-mkcd-f4\"\r\n\r\ninterface JRes {\r\n    id: string; // something like \"sounds.bark\"\r\n    data: string;\r\n    dataEncoding?: string; // must be \"base64\" or missing (meaning the same)\r\n    icon?: string; // URL (usually data-URI) for the icon\r\n    namespace?: string; // used to construct id\r\n    mimeType: string;\r\n    tilemapTile?: boolean;\r\n    tileset?: string[];\r\n}\r\n\r\nexport const arcadePalette = [\r\n    \"#000000\",\r\n    \"#ffffff\",\r\n    \"#ff2121\",\r\n    \"#ff93c4\",\r\n    \"#ff8135\",\r\n    \"#fff609\",\r\n    \"#249ca3\",\r\n    \"#78dc52\",\r\n    \"#003fad\",\r\n    \"#87f2ff\",\r\n    \"#8e2ec4\",\r\n    \"#a4839f\",\r\n    \"#5c406c\",\r\n    \"#e5cdc4\",\r\n    \"#91463d\",\r\n    \"#000000\"\r\n];\r\n\r\n/*\r\n{\r\n    \"kind\": \"script\",\r\n    \"id\": \"62736-71028-62577-28752\",\r\n    \"shortid\": \"_UAVXEwU7RAew\",\r\n    \"time\": 1595883166,\r\n    \"name\": \"Untitled\",\r\n    \"description\": \"Made with ❤️ in Microsoft MakeCode Arcade.\",\r\n    \"target\": \"arcade\",\r\n    \"editor\": \"tsprj\",\r\n    \"meta\": {\r\n        \"versions\": {\r\n            \"branch\": \"v1.0.14\",\r\n            \"tag\": \"v1.0.14\",\r\n            \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/1460ac1c88950799eb51c9c297588c8abdc91077\",\r\n            \"target\": \"1.0.14\",\r\n            \"pxt\": \"6.1.41\"\r\n        },\r\n        \"blocksHeight\": 0,\r\n        \"blocksWidth\": 0\r\n    },\r\n    \"thumb\": false\r\n}\r\n*/\r\n\r\nexport interface ScriptMeta {\r\n    kind: \"script\";\r\n    id: string;\r\n    shortid: string;\r\n    time: number;\r\n    name: string;\r\n    description: string;\r\n    target: string;\r\n    editor: string;\r\n    meta: {\r\n        versions: {\r\n            branch: string;\r\n            tag: string;\r\n            commits: string;\r\n            target: string;\r\n            pxt: string;\r\n        };\r\n        blocksHeight: number;\r\n        blocksWidth: number;\r\n    };\r\n    thumb: boolean;\r\n}\r\n\r\nexport interface ScriptInfo {\r\n    meta: ScriptMeta;\r\n    files: {[index: string]: string};\r\n    customPalette?: string[];\r\n    images: JRESImage[];\r\n}\r\n\r\n\r\nexport async function fetchMakeCodeScriptAsync(url: string) {\r\n    // https://makecode.com/_UAVXEwU7RAew\r\n    // https://arcade.makecode.com/62736-71028-62577-28752\r\n    let scriptID = url.trim();\r\n\r\n    if (scriptID.indexOf(\"/\") !== -1) {\r\n        scriptID = scriptID.substr(scriptID.lastIndexOf(\"/\") + 1)\r\n    }\r\n\r\n    const meta: ScriptMeta = await httpGetJSONAsync(backendEndpoint + \"/\" + scriptID);\r\n\r\n    // A mapping of filenames to filecontents\r\n    const filesystem: {[index: string]: string} = await httpGetJSONAsync(backendEndpoint + \"/\" + scriptID + \"/text\");\r\n\r\n    const config = filesystem[\"pxt.json\"];\r\n\r\n    let palette = arcadePalette;\r\n    let paletteIsCustom = false;\r\n\r\n    if (config) {\r\n        try {\r\n            let parsedConfig = JSON.parse(config);\r\n\r\n            if (parsedConfig?.palette && Array.isArray(parsedConfig.palette)) {\r\n                palette = parsedConfig.palette.slice()\r\n                paletteIsCustom = true;\r\n            }\r\n        }\r\n        catch (e) {\r\n            // ignore\r\n        }\r\n    }\r\n\r\n    // Don't bother checking python and blocks files, they should all get converted to a matching ts\r\n    // file that will also contain all image literals\r\n    const typescriptFiles = Object.keys(filesystem).filter(filename =>\r\n        filename.endsWith(\".ts\") || filename.endsWith(\".jres\"));\r\n\r\n    // Grab any existing images in the project\r\n    const projectImages: JRESImage[] = [];\r\n    for (const filename of typescriptFiles) {\r\n\r\n        const fileText = filesystem[filename];\r\n        if (filename.endsWith(\"jres\")) {\r\n            projectImages.push(...grabImagesFromJRES(fileText, filename, palette));\r\n        }\r\n        else {\r\n            projectImages.push(...grabImagesFromTypeScript(fileText, filename, palette));\r\n        }\r\n    }\r\n\r\n    // Dedupe the images based on their content\r\n    const seenImages: {[index: string]: JRESImage} = {};\r\n\r\n    for (const image of projectImages) {\r\n        const existing = seenImages[image.data];\r\n        // Prefer images that have qualified names (from JRES)\r\n        if (!existing || (!existing.qualifiedName && image.qualifiedName)) {\r\n            seenImages[image.data] = image;\r\n        }\r\n    }\r\n\r\n    return {\r\n        meta,\r\n        files: filesystem,\r\n        projectImages: Object.keys(seenImages).map(data => seenImages[data]),\r\n        customPalette: paletteIsCustom ? palette : undefined\r\n    };\r\n}\r\n\r\nfunction grabImagesFromJRES(jresText: string, filename: string, palette = arcadePalette): JRESImage[] {\r\n    let jres: {[index: string]: JRes | string};\r\n\r\n    try {\r\n        jres = JSON.parse(jresText);\r\n    }\r\n    catch (e) {\r\n        return [];\r\n    }\r\n\r\n    const metaEntry = jres[\"*\"] as JRes | undefined;\r\n\r\n    const metaMime = metaEntry?.mimeType || \"\";\r\n    const metaNamespace = metaEntry?.namespace || \"\";\r\n\r\n    const result: JRESImage[] = [];\r\n\r\n    for (const id of Object.keys(jres)) {\r\n        if (id === \"*\") continue;\r\n\r\n        let entry = jres[id];\r\n\r\n        if (typeof entry === \"string\") {\r\n            if (metaMime === IMAGE_MIME_TYPE) {\r\n                result.push(getJRESImageFromDataString(entry, palette, metaNamespace ? metaNamespace + \".\" + id : id, false, filename));\r\n            }\r\n        }\r\n        else if (entry.mimeType === IMAGE_MIME_TYPE) {\r\n            result.push(getJRESImageFromDataString(entry.data, palette, metaNamespace ? metaNamespace + \".\" + id : id, entry.tilemapTile, filename));\r\n        }\r\n    }\r\n\r\n    return result\r\n}\r\n\r\nfunction grabImagesFromTypeScript(fileText: string, filename: string, palette = arcadePalette) {\r\n    const literalRegex = /img\\s*`[\\s\\da-f.#tngrpoyw]*`/img;\r\n\r\n    const res: JRESImage[] = [];\r\n\r\n    fileText.replace(literalRegex, match => {\r\n        res.push(getJRESImageFromImageLiteral(match, palette, filename))\r\n        return \"\";\r\n    });\r\n\r\n    return res;\r\n}\r\n\r\n\r\nfunction httpGetJSONAsync(url: string): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        const request = new XMLHttpRequest();\r\n\r\n        request.addEventListener(\"error\", err => {\r\n            reject(err);\r\n        });\r\n\r\n        request.addEventListener(\"load\", () => {\r\n            try {\r\n                resolve(JSON.parse(request.responseText));\r\n            }\r\n            catch (e) {\r\n                reject(e);\r\n            }\r\n        });\r\n\r\n        request.open(\"GET\", url);\r\n        request.send();\r\n    });\r\n}","import React from 'react';\r\nimport { Alert, AlertProps } from './Alert';\r\nimport { Asset, AssetInfo } from './Asset';\r\nimport { JRESImage, getJRESImageFromDataString } from '../images'\r\nimport { arcadePalette, fetchMakeCodeScriptAsync } from '../share';\r\nimport '../styles/AssetList.css';\r\n\r\ninterface AlertInfo extends AlertProps {\r\n    type: \"delete\" | \"import\" | \"warning\";\r\n}\r\n\r\ninterface AssetListProps {\r\n    postMessage: (msg: any) => void;\r\n}\r\n\r\ninterface AssetListState {\r\n    items: AssetInfo[];\r\n    selected: number;\r\n    saving?: number;\r\n    alert?: AlertInfo;\r\n}\r\n\r\nconst DEFAULT_NAME = \"mySprite\";\r\nconst DEFAULT_JRES = {\r\n    data: \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\r\n    previewURI: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAH0lEQVQ4T2NkoBAwUqifYdQAhtEwYBgNA1A+Gvi8AAAmmAARf9qcXAAAAABJRU5ErkJggg==\",\r\n    width: 16,\r\n    height: 16,\r\n}\r\n\r\nclass AssetList extends React.Component<AssetListProps, AssetListState> {\r\n    private _items: AssetInfo[];\r\n    private _inputRef!: HTMLInputElement;\r\n\r\n    constructor(props: AssetListProps) {\r\n        super(props);\r\n        this._items =  [{ name: DEFAULT_NAME, jres: { ...DEFAULT_JRES } }];\r\n        this.state = {\r\n            items: this._items,\r\n            selected: 0\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener(\"message\", this.handleMessage);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"message\", this.handleMessage);\r\n    }\r\n\r\n    componentDidUpdate(prevProps: AssetListProps, prevState: AssetListState) {\r\n        if (this.state.saving !== undefined && prevState.saving === undefined) {\r\n            this.getJres();\r\n        }\r\n        if (this.state.selected !== prevState.selected || this.state.selected === 0) {\r\n            this.loadJres(this._items[this.state.selected]);\r\n        }\r\n    }\r\n\r\n    handleMessage = (msg: any) => {\r\n        const data = msg.data;\r\n        switch (data.type) {\r\n            case \"update\":\r\n                const jresImage = getJRESImageFromDataString(data.message, arcadePalette);\r\n                if (this.state.saving !== undefined) {\r\n                    const saving = this.state.saving;\r\n                    this._items[this.state.selected].jres = jresImage;\r\n                    this.setState({\r\n                        items: this._items,\r\n                        selected: saving,\r\n                        saving: undefined\r\n                    });\r\n                } else {\r\n                    this._items[this.state.selected].jres = jresImage;\r\n                    this.setState({ items: this._items });\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    loadJres = (asset: AssetInfo) => {\r\n        this.props.postMessage({ type: \"initialize\", message: asset.jres.data });\r\n    }\r\n\r\n    getJres = () => {\r\n        this.props.postMessage({ type: \"update\" });\r\n    }\r\n\r\n    /** ASSET HANDLING */\r\n\r\n    addAsset(name?: string) {\r\n        this._items.push({\r\n            name: this.getValidAssetName(name || DEFAULT_NAME),\r\n            jres: { ...DEFAULT_JRES }\r\n        })\r\n        this.setState({\r\n            items: this._items,\r\n            saving: this._items.length - 1\r\n         });\r\n    }\r\n\r\n    deleteAsset(index: number) {\r\n        this._items.splice(index, 1);\r\n        this.setState({\r\n            items: this._items,\r\n            selected: Math.max(index - 1, 0)\r\n         })\r\n    }\r\n\r\n    renameAsset(index: number, newName: string) {\r\n        if (this._items[index].name !== newName) {\r\n            this._items[index].name = this.getValidAssetName(newName);\r\n            this.setState({ items: this._items });\r\n        }\r\n    }\r\n\r\n    importAssets(url: string, replace?: boolean) {\r\n        fetchMakeCodeScriptAsync(url).then((res: {projectImages: JRESImage[]}) => {\r\n            if (replace) this._items = [];\r\n            res.projectImages.forEach((el: JRESImage) => {\r\n                this._items.push({ name: el.qualifiedName || this.getValidAssetName(DEFAULT_NAME), jres: el })\r\n            } )\r\n            this.setState({items: this._items})\r\n        })\r\n    }\r\n\r\n    getAssetIndex(name: string): number {\r\n        return this._items.findIndex((el) => el.name.toLowerCase() === name.toLowerCase());\r\n    }\r\n\r\n    getValidAssetName(name: string): string {\r\n        name = name.replace(/[^a-zA-Z0-9]/g, '');\r\n        while (this.getAssetIndex(name) >= 0) {\r\n            let r = name.match(/^(.*?)(\\d+)$/);\r\n            // increment counter by one\r\n            name = r ? r[1] + (parseInt(r[2], 10) + 1) : name + \"2\";\r\n        }\r\n        return name;\r\n    }\r\n\r\n    /** ASSET EVENT LISTENERS */\r\n\r\n    onAssetClick = (index: number): (e: any) => void => {\r\n        return () => {\r\n            this.setState({ saving: index });\r\n        }\r\n    }\r\n\r\n    onAssetRename = (index: number): (name: string) => void => {\r\n        return (name: string) => { this.renameAsset(index, name) };\r\n    }\r\n\r\n    onAddButtonClick = () => {\r\n        this.addAsset(DEFAULT_NAME);\r\n    }\r\n\r\n    onDeleteButtonClick = () => {\r\n        if (this._items.length > 1) {\r\n            this.setState({\r\n                alert: {\r\n                    type: \"delete\",\r\n                    icon: \"exclamation triangle\",\r\n                    title: \"Warning!\",\r\n                    text: \"Deleting an image is permanent. You will not be able to undo this action.\",\r\n                    options: [{\r\n                            text: \"Delete\",\r\n                            onClick: () => {\r\n                                this.deleteAsset(this.state.selected);\r\n                                this.hideAlert();\r\n                            }\r\n                        }]\r\n                }\r\n            })\r\n        } else {\r\n            this.setState({\r\n                alert: {\r\n                    type: \"warning\",\r\n                    icon: \"ban\",\r\n                    title: \"Unable to delete\",\r\n                    text: \"You must have at least one image in your project.\",\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    onImportButtonClick = () => {\r\n        this.setState({\r\n            alert: {\r\n                type: \"import\",\r\n                icon: \"upload\",\r\n                title: \"Import Sprites\",\r\n                text: \"Paste the URL to a shared game from MakeCode Arcade to import sprites from an existing project.\",\r\n                options: [{\r\n                        text: \"Import\",\r\n                        onClick: () => {\r\n                            this.importAssets(this._inputRef.value);\r\n                            this.hideAlert();\r\n                        }\r\n                    }]\r\n            }\r\n        })\r\n    }\r\n\r\n    onExportButtonClick = () => {\r\n        // ensure we have most updated sprites\r\n        this.getJres();\r\n    }\r\n\r\n    hideAlert = () => {\r\n        this.setState({ alert: undefined });\r\n    }\r\n\r\n    handleInputRef = (el: HTMLInputElement) => {\r\n        this._inputRef = el;\r\n    }\r\n\r\n    render() {\r\n        const { items, selected, alert } = this.state;\r\n\r\n        return <div id=\"asset-list\">\r\n            {alert && <Alert icon={alert.icon} title={alert.title} text={alert.text} options={alert.options} visible={true} onClose={this.hideAlert}>\r\n                {alert.type === \"import\" && <input className=\"asset-import\" ref={this.handleInputRef} placeholder=\"https://makecode.com/_r8fboJQTDPtH or https://arcade.makeode.com/62736-71128-62577-28722\" />}\r\n            </Alert>}\r\n            <div className=\"asset-list-buttons\">\r\n                <div className=\"asset-button\" title=\"Add asset\" onClick={this.onAddButtonClick}>\r\n                    <i className=\"icon plus square outline\"></i>\r\n                </div>\r\n                <div className=\"asset-button\" title=\"Import assets\" onClick={this.onImportButtonClick}>\r\n                    <i className=\"icon upload\"></i>\r\n                </div>\r\n                <div className=\"asset-button\" title=\"Export assets\" onClick={this.onExportButtonClick}>\r\n                    <i className=\"icon download\"></i>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                { items.map((item, i) => {\r\n                    return <Asset\r\n                        key={i}\r\n                        info={item}\r\n                        selected={i === selected}\r\n                        onClick={this.onAssetClick(i)}\r\n                        onRename={this.onAssetRename(i)}\r\n                        onDelete={this.onDeleteButtonClick} />\r\n                }) }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default AssetList","import React from 'react';\r\nimport AssetList from './components/AssetList';\r\nimport './styles/App.css';\r\n\r\nclass App extends React.Component {\r\n    private iframe!: HTMLIFrameElement;\r\n    componentDidMount() {\r\n        this.iframe = document.getElementById(\"editor\") as HTMLIFrameElement;\r\n    }\r\n\r\n    postMessage = (data: any) => {\r\n        if (this.iframe && this.iframe.contentWindow) {\r\n            data[\"_fromVscode\"] = true; // fake _fromVscode for now\r\n            this.iframe.contentWindow.postMessage(data, \"*\");\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"app\">\r\n                <iframe id=\"editor\" title=\"MakeCode Arcade sprite editor\" src=\"https://arcade.makecode.com/beta--asseteditor\" />\r\n                <AssetList postMessage={this.postMessage} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './styles/index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}