{"version":3,"sources":["components/Asset.tsx","images.ts","share.ts","components/AssetList.tsx","App.tsx","index.tsx"],"names":["Asset","this","props","info","selected","onClick","name","jres","className","src","previewURI","alt","React","Component","getJRESImageFromDataString","data","palette","qname","tilemapTile","sourceFile","getJRESImage","jresURL","atob","slice","indexOf","magic","charCodeAt","w","h","out","Bitmap","index","mask","v","x","y","set","jresDataToBitmap","getJRESImageFromImageLiteral","literal","text","defaultPattern","replace","trim","rows","split","sprite","spriteWidth","r","length","row","rowValues","c","push","Math","max","spriteHeight","result","imageLiteralToBitmap","undefined","bitmap","width","height","base64EncodeBitmap","bitmapToImageURI","qualifiedName","f4EncodeImgCore","bpp","getPix","hex2","ptr","curr","shift","pushBits","n","i","j","toString","hex","get","btoa","input","len","res","String","fromCharCode","uint8ArrayToString","Uint8ClampedArray","parseInt","hexToUint8Array","x0","y0","buf","dataLength","col","value","coordToIndex","setCore","getCore","cell","floor","ceil","frame","colors","canvas","document","createElement","context","getContext","color","fillStyle","fillRect","toDataURL","backendEndpoint","arcadePalette","url","a","scriptID","substr","lastIndexOf","httpGetJSONAsync","meta","filesystem","config","paletteIsCustom","parsedConfig","JSON","parse","Array","isArray","e","typescriptFiles","Object","keys","filter","filename","endsWith","projectImages","fileText","grabImagesFromJRES","grabImagesFromTypeScript","seenImages","image","existing","files","map","customPalette","jresText","metaEntry","metaMime","mimeType","metaNamespace","namespace","id","entry","literalRegex","match","Promise","resolve","reject","request","XMLHttpRequest","addEventListener","err","responseText","open","send","DEFAULT_JRES","AssetList","_items","handleMessage","msg","type","jresImage","message","state","saving","setState","items","loadJres","asset","postMessage","getJres","onAssetClick","getAssetIndex","onAddButtonClick","addAsset","onDeleteButtonClick","deleteAsset","window","fetchMakeCodeScriptAsync","then","forEach","el","getValidAssetName","removeEventListener","prevProps","prevState","splice","findIndex","title","item","key","App","iframe","contentWindow","getElementById","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.fc067fa2.chunk.js","sourcesContent":["import React from 'react';\r\nimport { JRESImage } from '../images';\r\nimport '../styles/Asset.css';\r\n\r\nexport interface AssetInfo {\r\n    name: string;\r\n    jres: JRESImage;\r\n}\r\n\r\ninterface AssetProps {\r\n    info: AssetInfo;\r\n    selected: boolean;\r\n    onClick?: (e: any) => void;\r\n}\r\n\r\nexport class Asset extends React.Component<AssetProps, {}> {\r\n    render() {\r\n        const { info, selected, onClick } = this.props;\r\n        const { name, jres } = info;\r\n\r\n        return <div className={`asset ${selected ? \"selected\" : \"\"}`} onClick={onClick}>\r\n            <div className=\"asset-img\">\r\n                <img src={jres.previewURI} alt=\"Preview of asset\" />\r\n            </div>\r\n            <div className=\"asset-title\"><span>{name}</span></div>\r\n        </div>\r\n    }\r\n}","export interface JRESImage {\r\n    data: string; // Base64 encoded string of f4 encoded bytes\r\n    previewURI: string; // PNG data uri\r\n    width: number;\r\n    height: number;\r\n\r\n    qualifiedName?: string;\r\n    tilemapTile?: boolean;\r\n    sourceFile?: string;\r\n}\r\n\r\nexport interface ImageInfo {\r\n    width: number;\r\n    height: number;\r\n    pixels: Uint8ClampedArray;\r\n}\r\n\r\nexport async function getImageFromURIAsync(uri: string): Promise<ImageInfo | null> {\r\n    const loaded = await loadImageAsync(uri);\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = loaded.width;\r\n    canvas.height = loaded.height;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) return null;\r\n\r\n    ctx.drawImage(loaded, 0, 0);\r\n    const data = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n\r\n    return {\r\n        width: data.width,\r\n        height: data.height,\r\n        pixels: data.data\r\n    };\r\n}\r\n\r\nasync function loadImageAsync(uri: string): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>(resolve => {\r\n        const el = document.createElement(\"img\");\r\n        el.src = uri\r\n        el.onload = () => {\r\n            resolve(el)\r\n        };\r\n    })\r\n}\r\n\r\nexport function getJRESImageFromDataString(data: string, palette: string[], qname?: string, tilemapTile?: boolean, sourceFile?: string): JRESImage {\r\n    const bitmap = jresDataToBitmap(data);\r\n\r\n    return getJRESImage(bitmap, palette, data, qname, tilemapTile, sourceFile)\r\n}\r\n\r\nexport function getJRESImageFromImageLiteral(literal: string, palette: string[], sourceFile?: string) {\r\n    const bitmap = imageLiteralToBitmap(literal);\r\n    return getJRESImage(bitmap, palette, undefined, undefined, undefined, sourceFile)\r\n}\r\n\r\n\r\nfunction getJRESImage(bitmap: Bitmap, palette: string[], data?: string, qname?: string, tilemapTile?: boolean, sourceFile?: string): JRESImage {\r\n    return {\r\n        width: bitmap.width,\r\n        height: bitmap.height,\r\n        data: data || base64EncodeBitmap(bitmap),\r\n        previewURI: bitmapToImageURI(bitmap, palette),\r\n        qualifiedName: qname,\r\n        tilemapTile,\r\n        sourceFile\r\n    }\r\n}\r\n\r\n/**\r\n * Encodes the image in the image/mkcd-f4 format (used for the data attribute in jres files)\r\n * @param image\r\n * @param colors\r\n */\r\nexport function f4EncodeImage(image: ImageInfo, colors: string[]) {\r\n    const palette = colorsToNumbers(colors);\r\n\r\n    return f4EncodeImgCore(image.width, image.height, 4, (x, y) => {\r\n        const index = y * image.width + x;\r\n        return closestColor(image.pixels, index << 2, palette);\r\n    });\r\n}\r\n\r\n/**\r\n * Encodes the image as an img`` literal\r\n * @param image\r\n * @param colors\r\n */\r\nexport function imgEncodeImage(image: ImageInfo, colors: string[]) {\r\n    const palette = colorsToNumbers(colors);\r\n\r\n    return imgEncodeImgCore(image.width, image.height, (x, y) => {\r\n        const index = y * image.width + x;\r\n        return closestColor(image.pixels, index << 2, palette);\r\n    });\r\n}\r\n\r\nfunction colorsToNumbers(colors: string[]): number[][] {\r\n    const res: number[][] = [];\r\n    for (let i = 0; i < colors.length; i++) {\r\n        const color = parseColorString(colors[i]);\r\n        res.push([_r(color), _g(color), _b(color)]);\r\n    }\r\n    return res;\r\n}\r\n\r\n// use geometric distance on colors\r\nfunction scale(v: number) {\r\n    return v * v\r\n}\r\n\r\nfunction closestColor(buf: Uint8ClampedArray, pix: number, palette: number[][], alpha = true) {\r\n    if (alpha && buf[pix + 3] < 100)\r\n        return 0 // transparent\r\n    let mindelta = 0\r\n    let idx = -1\r\n    for (let i = alpha ? 1 : 0; i < palette.length; ++i) {\r\n        let delta = scale(palette[i][0] - buf[pix + 0]) + scale(palette[i][1] - buf[pix + 1]) + scale(palette[i][2] - buf[pix + 2])\r\n        if (idx < 0 || delta < mindelta) {\r\n            idx = i\r\n            mindelta = delta\r\n        }\r\n    }\r\n    return idx\r\n}\r\n\r\nfunction f4EncodeImgCore(w: number, h: number, bpp: number, getPix: (x: number, y: number) => number) {\r\n    let r = hex2(0xe0 | bpp) + hex2(w) + hex2(h) + \"00\"\r\n    let ptr = 4\r\n    let curr = 0\r\n    let shift = 0\r\n\r\n    let pushBits = (n: number) => {\r\n        curr |= n << shift\r\n        // eslint-disable-next-line\r\n        if (shift == 8 - bpp) {\r\n            r += hex2(curr)\r\n            ptr++\r\n            curr = 0\r\n            shift = 0\r\n        } else {\r\n            shift += bpp\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < w; ++i) {\r\n        for (let j = 0; j < h; ++j)\r\n            pushBits(getPix(i, j))\r\n        // eslint-disable-next-line\r\n        while (shift != 0)\r\n            pushBits(0)\r\n        if (bpp > 1) {\r\n            while (ptr & 3)\r\n                pushBits(0)\r\n        }\r\n    }\r\n\r\n    return r\r\n\r\n    function hex2(n: number) {\r\n        return (\"0\" + n.toString(16)).slice(-2)\r\n    }\r\n}\r\n\r\nfunction imgEncodeImgCore(w: number, h: number, getPix: (x: number, y: number) => number) {\r\n    let res = \"img`\\n    \"\r\n    for (let r = 0; r < h; r++) {\r\n        let row: number[] = []\r\n        for (let c = 0; c < w; c++) {\r\n            row.push(getPix(c, r));\r\n        }\r\n        res += row.map(n => n.toString(16)).join(\" \");\r\n        res += \"\\n    \"\r\n    }\r\n    res += \"`\";\r\n    return res;\r\n}\r\n\r\nfunction base64EncodeBitmap(bitmap: Bitmap) {\r\n    const hex = f4EncodeImgCore(bitmap.width, bitmap.height, 4, (x, y) => bitmap.get(x, y));\r\n    return btoa(uint8ArrayToString(hexToUint8Array(hex)))\r\n}\r\n\r\nfunction _r(color: number) { return (color >> 16) & 0xff }\r\nfunction _g(color: number) { return (color >> 8) & 0xff }\r\nfunction _b(color: number) { return color & 0xff }\r\n\r\nfunction parseColorString(color: string) {\r\n    if (color) {\r\n        if (color.length === 6) {\r\n            return parseInt(\"0x\" + color);\r\n        }\r\n        else if (color.length === 7) {\r\n            return parseInt(\"0x\" + color.substr(1));\r\n        }\r\n    }\r\n    return 0;\r\n}\r\n\r\n/**\r\n * 16-color sprite\r\n */\r\nexport class Bitmap {\r\n    protected buf: Uint8ClampedArray;\r\n\r\n    constructor(public width: number, public height: number, public x0 = 0, public y0 = 0, buf?: Uint8ClampedArray) {\r\n        this.buf = buf || new Uint8ClampedArray(this.dataLength());\r\n    }\r\n\r\n    set(col: number, row: number, value: number) {\r\n        if (col < this.width && row < this.height && col >= 0 && row >= 0) {\r\n            const index = this.coordToIndex(col, row);\r\n            this.setCore(index, value);\r\n        }\r\n    }\r\n\r\n    get(col: number, row: number) {\r\n        if (col < this.width && row < this.height && col >= 0 && row >= 0) {\r\n            const index = this.coordToIndex(col, row);\r\n            return this.getCore(index);\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    protected coordToIndex(col: number, row: number) {\r\n        return col + row * this.width;\r\n    }\r\n\r\n    protected getCore(index: number) {\r\n        const cell = Math.floor(index / 2);\r\n        if (index % 2 === 0) {\r\n            return this.buf[cell] & 0xf;\r\n        }\r\n        else {\r\n            return (this.buf[cell] & 0xf0) >> 4;\r\n        }\r\n    }\r\n\r\n    protected setCore(index: number, value: number) {\r\n        const cell = Math.floor(index / 2);\r\n        if (index % 2 === 0) {\r\n            this.buf[cell] = (this.buf[cell] & 0xf0) | (value & 0xf);\r\n        }\r\n        else {\r\n            this.buf[cell] = (this.buf[cell] & 0x0f) | ((value & 0xf) << 4);\r\n        }\r\n    }\r\n\r\n    protected dataLength() {\r\n        return Math.ceil(this.width * this.height / 2);\r\n    }\r\n}\r\n\r\n\r\nfunction jresDataToBitmap(jresURL: string) {\r\n    let data = atob(jresURL.slice(jresURL.indexOf(\",\") + 1))\r\n    let magic = data.charCodeAt(0);\r\n    let w = data.charCodeAt(1);\r\n    let h = data.charCodeAt(2);\r\n\r\n    if (magic === 0x87) {\r\n        magic = 0xe0 | data.charCodeAt(1);\r\n        w = data.charCodeAt(2) | (data.charCodeAt(3) << 8);\r\n        h = data.charCodeAt(4) | (data.charCodeAt(5) << 8);\r\n        data = data.slice(4);\r\n    }\r\n\r\n    const out = new Bitmap(w, h);\r\n\r\n    let index = 4\r\n    if (magic === 0xe1) {\r\n        // Monochrome\r\n        let mask = 0x01\r\n        let v = data.charCodeAt(index++)\r\n        for (let x = 0; x < w; ++x) {\r\n            for (let y = 0; y < h; ++y) {\r\n                out.set(x, y, (v & mask) ? 1 : 0);\r\n                mask <<= 1\r\n                // eslint-disable-next-line\r\n                if (mask == 0x100) {\r\n                    mask = 0x01\r\n                    v = data.charCodeAt(index++)\r\n                }\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        // Color\r\n        for (let x = 0; x < w; x++) {\r\n            for (let y = 0; y < h; y += 2) {\r\n                let v = data.charCodeAt(index++)\r\n                out.set(x, y, v & 0xf);\r\n                // eslint-disable-next-line\r\n                if (y != h - 1) {\r\n                    out.set(x, y + 1, (v >> 4) & 0xf);\r\n                }\r\n            }\r\n            while (index & 3) index++\r\n        }\r\n    }\r\n\r\n    return out;\r\n}\r\n\r\nfunction imageLiteralToBitmap(text: string, defaultPattern?: string): Bitmap {\r\n    // Strip the tagged template string business and the whitespace. We don't have to exhaustively\r\n    // replace encoded characters because the compiler will catch any disallowed characters and throw\r\n    // an error before the decompilation happens. 96 is backtick and 9 is tab\r\n    text = text.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g, \"\").trim();\r\n    // eslint-disable-next-line\r\n    text = text.replace(/^[\"`\\(\\)]*/, '').replace(/[\"`\\(\\)]*$/, '');\r\n    text = text.replace(/&#10;/g, \"\\n\");\r\n\r\n    if (!text && defaultPattern)\r\n        text = defaultPattern;\r\n\r\n    const rows = text.split(\"\\n\");\r\n\r\n    // We support \"ragged\" sprites so not all rows will be the same length\r\n    const sprite: number[][] = [];\r\n    let spriteWidth = 0;\r\n\r\n    for (let r = 0; r < rows.length; r++) {\r\n        const row = rows[r];\r\n        const rowValues: number[] = [];\r\n        for (let c = 0; c < row.length; c++) {\r\n            // This list comes from libs/screen/targetOverrides.ts in pxt-arcade\r\n            // Technically, this could change per target.\r\n            switch (row[c]) {\r\n                case \"0\": case \".\": rowValues.push(0); break;\r\n                case \"1\": case \"#\": rowValues.push(1); break;\r\n                case \"2\": case \"T\": rowValues.push(2); break;\r\n                case \"3\": case \"t\": rowValues.push(3); break;\r\n                case \"4\": case \"N\": rowValues.push(4); break;\r\n                case \"5\": case \"n\": rowValues.push(5); break;\r\n                case \"6\": case \"G\": rowValues.push(6); break;\r\n                case \"7\": case \"g\": rowValues.push(7); break;\r\n                case \"8\": rowValues.push(8); break;\r\n                case \"9\": rowValues.push(9); break;\r\n                case \"a\": case \"A\": case \"R\": rowValues.push(10); break;\r\n                case \"b\": case \"B\": case \"P\": rowValues.push(11); break;\r\n                case \"c\": case \"C\": case \"p\": rowValues.push(12); break;\r\n                case \"d\": case \"D\": case \"O\": rowValues.push(13); break;\r\n                case \"e\": case \"E\": case \"Y\": rowValues.push(14); break;\r\n                case \"f\": case \"F\": case \"W\": rowValues.push(15); break;\r\n            }\r\n        }\r\n\r\n        if (rowValues.length) {\r\n            sprite.push(rowValues);\r\n            spriteWidth = Math.max(spriteWidth, rowValues.length);\r\n        }\r\n    }\r\n\r\n    const spriteHeight = sprite.length;\r\n\r\n    const result = new Bitmap(spriteWidth, spriteHeight)\r\n\r\n    for (let r = 0; r < spriteHeight; r++) {\r\n        const row = sprite[r];\r\n        for (let c = 0; c < spriteWidth; c++) {\r\n            if (c < row.length) {\r\n                result.set(c, r, row[c]);\r\n            }\r\n            else {\r\n                result.set(c, r, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Converts a bitmap into a square image suitable for display\r\n */\r\nfunction bitmapToImageURI(frame: Bitmap, colors: string[]) {\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = frame.width;\r\n    canvas.height = frame.height;\r\n\r\n    let context = canvas.getContext(\"2d\");\r\n\r\n    if (context) {\r\n        for (let c = 0; c < frame.width; c++) {\r\n            for (let r = 0; r < frame.height; r++) {\r\n                const color = frame.get(c, r);\r\n\r\n                if (color) {\r\n                    context.fillStyle = colors[color];\r\n                    context.fillRect(c, r, 1, 1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    return canvas.toDataURL();\r\n}\r\n\r\nfunction hexToUint8Array(hex: string) {\r\n    let r = new Uint8ClampedArray(hex.length >> 1);\r\n    for (let i = 0; i < hex.length; i += 2)\r\n        r[i >> 1] = parseInt(hex.slice(i, i + 2), 16)\r\n    return r\r\n}\r\n\r\nfunction uint8ArrayToString(input: ArrayLike<number>) {\r\n    let len = input.length;\r\n    let res = \"\"\r\n    for (let i = 0; i < len; ++i)\r\n        res += String.fromCharCode(input[i]);\r\n    return res;\r\n}","import { getJRESImageFromDataString, getJRESImageFromImageLiteral, JRESImage } from \"./images\";\r\n\r\nconst backendEndpoint = \"https://makecode.com/api\";\r\n\r\nconst IMAGE_MIME_TYPE = \"image/x-mkcd-f4\"\r\n\r\ninterface JRes {\r\n    id: string; // something like \"sounds.bark\"\r\n    data: string;\r\n    dataEncoding?: string; // must be \"base64\" or missing (meaning the same)\r\n    icon?: string; // URL (usually data-URI) for the icon\r\n    namespace?: string; // used to construct id\r\n    mimeType: string;\r\n    tilemapTile?: boolean;\r\n    tileset?: string[];\r\n}\r\n\r\nexport const arcadePalette = [\r\n    \"#000000\",\r\n    \"#ffffff\",\r\n    \"#ff2121\",\r\n    \"#ff93c4\",\r\n    \"#ff8135\",\r\n    \"#fff609\",\r\n    \"#249ca3\",\r\n    \"#78dc52\",\r\n    \"#003fad\",\r\n    \"#87f2ff\",\r\n    \"#8e2ec4\",\r\n    \"#a4839f\",\r\n    \"#5c406c\",\r\n    \"#e5cdc4\",\r\n    \"#91463d\",\r\n    \"#000000\"\r\n];\r\n\r\n/*\r\n{\r\n    \"kind\": \"script\",\r\n    \"id\": \"62736-71028-62577-28752\",\r\n    \"shortid\": \"_UAVXEwU7RAew\",\r\n    \"time\": 1595883166,\r\n    \"name\": \"Untitled\",\r\n    \"description\": \"Made with ❤️ in Microsoft MakeCode Arcade.\",\r\n    \"target\": \"arcade\",\r\n    \"editor\": \"tsprj\",\r\n    \"meta\": {\r\n        \"versions\": {\r\n            \"branch\": \"v1.0.14\",\r\n            \"tag\": \"v1.0.14\",\r\n            \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/1460ac1c88950799eb51c9c297588c8abdc91077\",\r\n            \"target\": \"1.0.14\",\r\n            \"pxt\": \"6.1.41\"\r\n        },\r\n        \"blocksHeight\": 0,\r\n        \"blocksWidth\": 0\r\n    },\r\n    \"thumb\": false\r\n}\r\n*/\r\n\r\nexport interface ScriptMeta {\r\n    kind: \"script\";\r\n    id: string;\r\n    shortid: string;\r\n    time: number;\r\n    name: string;\r\n    description: string;\r\n    target: string;\r\n    editor: string;\r\n    meta: {\r\n        versions: {\r\n            branch: string;\r\n            tag: string;\r\n            commits: string;\r\n            target: string;\r\n            pxt: string;\r\n        };\r\n        blocksHeight: number;\r\n        blocksWidth: number;\r\n    };\r\n    thumb: boolean;\r\n}\r\n\r\nexport interface ScriptInfo {\r\n    meta: ScriptMeta;\r\n    files: {[index: string]: string};\r\n    customPalette?: string[];\r\n    images: JRESImage[];\r\n}\r\n\r\n\r\nexport async function fetchMakeCodeScriptAsync(url: string) {\r\n    // https://makecode.com/_UAVXEwU7RAew\r\n    // https://arcade.makecode.com/62736-71028-62577-28752\r\n    let scriptID = url.trim();\r\n\r\n    if (scriptID.indexOf(\"/\") !== -1) {\r\n        scriptID = scriptID.substr(scriptID.lastIndexOf(\"/\") + 1)\r\n    }\r\n\r\n    const meta: ScriptMeta = await httpGetJSONAsync(backendEndpoint + \"/\" + scriptID);\r\n\r\n    // A mapping of filenames to filecontents\r\n    const filesystem: {[index: string]: string} = await httpGetJSONAsync(backendEndpoint + \"/\" + scriptID + \"/text\");\r\n\r\n    const config = filesystem[\"pxt.json\"];\r\n\r\n    let palette = arcadePalette;\r\n    let paletteIsCustom = false;\r\n\r\n    if (config) {\r\n        try {\r\n            let parsedConfig = JSON.parse(config);\r\n\r\n            if (parsedConfig?.palette && Array.isArray(parsedConfig.palette)) {\r\n                palette = parsedConfig.palette.slice()\r\n                paletteIsCustom = true;\r\n            }\r\n        }\r\n        catch (e) {\r\n            // ignore\r\n        }\r\n    }\r\n\r\n    // Don't bother checking python and blocks files, they should all get converted to a matching ts\r\n    // file that will also contain all image literals\r\n    const typescriptFiles = Object.keys(filesystem).filter(filename =>\r\n        filename.endsWith(\".ts\") || filename.endsWith(\".jres\"));\r\n\r\n    // Grab any existing images in the project\r\n    const projectImages: JRESImage[] = [];\r\n    for (const filename of typescriptFiles) {\r\n\r\n        const fileText = filesystem[filename];\r\n        if (filename.endsWith(\"jres\")) {\r\n            projectImages.push(...grabImagesFromJRES(fileText, filename, palette));\r\n        }\r\n        else {\r\n            projectImages.push(...grabImagesFromTypeScript(fileText, filename, palette));\r\n        }\r\n    }\r\n\r\n    // Dedupe the images based on their content\r\n    const seenImages: {[index: string]: JRESImage} = {};\r\n\r\n    for (const image of projectImages) {\r\n        const existing = seenImages[image.data];\r\n        // Prefer images that have qualified names (from JRES)\r\n        if (!existing || (!existing.qualifiedName && image.qualifiedName)) {\r\n            seenImages[image.data] = image;\r\n        }\r\n    }\r\n\r\n    return {\r\n        meta,\r\n        files: filesystem,\r\n        projectImages: Object.keys(seenImages).map(data => seenImages[data]),\r\n        customPalette: paletteIsCustom ? palette : undefined\r\n    };\r\n}\r\n\r\nfunction grabImagesFromJRES(jresText: string, filename: string, palette = arcadePalette): JRESImage[] {\r\n    let jres: {[index: string]: JRes | string};\r\n\r\n    try {\r\n        jres = JSON.parse(jresText);\r\n    }\r\n    catch (e) {\r\n        return [];\r\n    }\r\n\r\n    const metaEntry = jres[\"*\"] as JRes | undefined;\r\n\r\n    const metaMime = metaEntry?.mimeType || \"\";\r\n    const metaNamespace = metaEntry?.namespace || \"\";\r\n\r\n    const result: JRESImage[] = [];\r\n\r\n    for (const id of Object.keys(jres)) {\r\n        if (id === \"*\") continue;\r\n\r\n        let entry = jres[id];\r\n\r\n        if (typeof entry === \"string\") {\r\n            if (metaMime === IMAGE_MIME_TYPE) {\r\n                result.push(getJRESImageFromDataString(entry, palette, metaNamespace ? metaNamespace + \".\" + id : id, false, filename));\r\n            }\r\n        }\r\n        else if (entry.mimeType === IMAGE_MIME_TYPE) {\r\n            result.push(getJRESImageFromDataString(entry.data, palette, metaNamespace ? metaNamespace + \".\" + id : id, entry.tilemapTile, filename));\r\n        }\r\n    }\r\n\r\n    return result\r\n}\r\n\r\nfunction grabImagesFromTypeScript(fileText: string, filename: string, palette = arcadePalette) {\r\n    const literalRegex = /img\\s*`[\\s\\da-f.#tngrpoyw]*`/img;\r\n\r\n    const res: JRESImage[] = [];\r\n\r\n    fileText.replace(literalRegex, match => {\r\n        res.push(getJRESImageFromImageLiteral(match, palette, filename))\r\n        return \"\";\r\n    });\r\n\r\n    return res;\r\n}\r\n\r\n\r\nfunction httpGetJSONAsync(url: string): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        const request = new XMLHttpRequest();\r\n\r\n        request.addEventListener(\"error\", err => {\r\n            reject(err);\r\n        });\r\n\r\n        request.addEventListener(\"load\", () => {\r\n            try {\r\n                resolve(JSON.parse(request.responseText));\r\n            }\r\n            catch (e) {\r\n                reject(e);\r\n            }\r\n        });\r\n\r\n        request.open(\"GET\", url);\r\n        request.send();\r\n    });\r\n}","import React from 'react';\r\nimport { Asset, AssetInfo } from './Asset';\r\nimport { JRESImage, getJRESImageFromDataString } from '../images'\r\nimport { arcadePalette, fetchMakeCodeScriptAsync } from '../share';\r\nimport '../styles/AssetList.css';\r\n\r\ninterface AssetListProps {\r\n    postMessage: (msg: any) => void;\r\n}\r\n\r\ninterface AssetListState {\r\n    items: AssetInfo[];\r\n    selected: number;\r\n    saving?: number;\r\n}\r\n\r\nconst DEFAULT_NAME = \"mySprite\";\r\nconst DEFAULT_JRES = {\r\n    data: \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\r\n    previewURI: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAH0lEQVQ4T2NkoBAwUqifYdQAhtEwYBgNA1A+Gvi8AAAmmAARf9qcXAAAAABJRU5ErkJggg==\",\r\n    width: 16,\r\n    height: 16,\r\n}\r\n\r\nclass AssetList extends React.Component<AssetListProps, AssetListState> {\r\n    private _items: AssetInfo[];\r\n\r\n    constructor(props: AssetListProps) {\r\n        super(props);\r\n        this._items =  [{ name: DEFAULT_NAME, jres: { ...DEFAULT_JRES } }];\r\n        this.state = {\r\n            items: this._items,\r\n            selected: 0\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener(\"message\", this.handleMessage);\r\n\r\n        // FOR TESTING! just loading in a script to make sure all the data parsing is correct\r\n        fetchMakeCodeScriptAsync(\"https://arcade.makecode.com/62736-71028-62577-28752\").then((res: {projectImages: JRESImage[]}) => {\r\n            this._items = [];\r\n            res.projectImages.forEach((el: JRESImage) => {\r\n                this._items.push({ name: el.qualifiedName || this.getValidAssetName(DEFAULT_NAME), jres: el })\r\n            } )\r\n            this.setState({items: this._items})\r\n        })\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"message\", this.handleMessage);\r\n    }\r\n\r\n    componentDidUpdate(prevProps: AssetListProps, prevState: AssetListState) {\r\n        if (this.state.saving !== undefined && prevState.saving === undefined) {\r\n            this.getJres();\r\n        }\r\n        if (this.state.selected !== prevState.selected) {\r\n            this.loadJres(this._items[this.state.selected]);\r\n        }\r\n    }\r\n\r\n    handleMessage = (msg: any) => {\r\n        const data = msg.data;\r\n        switch (data.type) {\r\n            case \"update\":\r\n                const jresImage = getJRESImageFromDataString(data.message, arcadePalette);\r\n                if (this.state.saving !== undefined) {\r\n                    const saving = this.state.saving;\r\n                    this._items[this.state.selected].jres = jresImage;\r\n                    this.setState({\r\n                        items: this._items,\r\n                        selected: saving,\r\n                        saving: undefined\r\n                    });\r\n                } else {\r\n                    this._items[this.state.selected].jres = jresImage;\r\n                    this.setState({ items: this._items });\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    loadJres = (asset: AssetInfo) => {\r\n        this.props.postMessage({ type: \"initialize\", message: asset.jres.data });\r\n    }\r\n\r\n    getJres = () => {\r\n        this.props.postMessage({ type: \"update\" })\r\n    }\r\n\r\n    /** ASSET HANDLING */\r\n\r\n    addAsset(name?: string) {\r\n        this._items.push({\r\n            name: this.getValidAssetName(name || DEFAULT_NAME),\r\n            jres: { ...DEFAULT_JRES }\r\n        })\r\n        this.setState({ items: this._items })\r\n    }\r\n\r\n    deleteAsset(index: number) {\r\n        this._items.splice(index, 1);\r\n        this.setState({\r\n            items: this._items,\r\n            selected: Math.max(index - 1, 0)\r\n         })\r\n    }\r\n\r\n    getAssetIndex(name: string): number {\r\n        return this._items.findIndex((el) => el.name === name);\r\n    }\r\n\r\n    getValidAssetName(name: string): string {\r\n        name = name.replace(/^[\\s\\xa0]+|[\\s\\xa0]+$/g, '');\r\n        while (this.getAssetIndex(name) >= 0) {\r\n            let r = name.match(/^(.*?)(\\d+)$/);\r\n            // increment counter by one\r\n            name = r ? r[1] + (parseInt(r[2], 10) + 1) : name + \"2\";\r\n        }\r\n        return name;\r\n    }\r\n\r\n    /** ASSET EVENT LISTENERS */\r\n\r\n    onAssetClick = (asset: AssetInfo): (e: any) => void => {\r\n        return () => {\r\n            this.setState({ saving: this.getAssetIndex(asset.name) });\r\n        }\r\n    }\r\n\r\n    onAddButtonClick = () => {\r\n        this.addAsset(DEFAULT_NAME);\r\n    }\r\n\r\n    onDeleteButtonClick = () => {\r\n        this.deleteAsset(this.state.selected);\r\n    }\r\n\r\n    render() {\r\n        const { items, selected } = this.state;\r\n\r\n        return <div id=\"asset-list\">\r\n            <div className=\"asset-list-buttons\">\r\n                <div className=\"asset-button\" title=\"Add asset\" onClick={this.onAddButtonClick}>\r\n                    <i className=\"icon plus\"></i>\r\n                </div>\r\n                <div className=\"asset-button\" title=\"Delete asset\" onClick={this.onDeleteButtonClick}>\r\n                    <i className=\"icon delete\"></i>\r\n                </div>\r\n                <div className=\"asset-button\" title=\"Rename asset\">\r\n                    <i className=\"icon i cursor\"></i>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                { items.map((item, i) => {\r\n                    return <Asset\r\n                        key={i}\r\n                        info={item}\r\n                        selected={i === selected}\r\n                        onClick={this.onAssetClick(item)} />\r\n                }) }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default AssetList","import React from 'react';\r\nimport AssetList from './components/AssetList';\r\nimport './styles/App.css';\r\n\r\nclass App extends React.Component {\r\n    private iframe!: HTMLIFrameElement;\r\n    componentDidMount() {\r\n        this.iframe = document.getElementById(\"editor\") as HTMLIFrameElement;\r\n    }\r\n\r\n    postMessage = (data: any) => {\r\n        if (this.iframe && this.iframe.contentWindow) {\r\n            data[\"_fromVscode\"] = true; // fake _fromVscode for now\r\n            this.iframe.contentWindow.postMessage(data, \"*\");\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"app\">\r\n                <iframe id=\"editor\" title=\"MakeCode Arcade sprite editor\" src=\"https://arcade.makecode.com/beta--asseteditor\" />\r\n                <AssetList postMessage={this.postMessage} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './styles/index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}